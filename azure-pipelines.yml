trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- script: sudo install -d -m 0777 /usr/envs
  displayName: Fix Conda permissions
- task: CondaEnvironment@0
  inputs:
    environmentName: 'tmbuild'
    packageSpecs: 'python=3.7'
- script: conda install -y conda-build
  displayName: Install dependencies with conda
- bash: cd tmap
- script: conda build .
  displayName: 'Conda build tmap'
- task: DownloadBuildArtifacts@0
  inputs:
    buildType: 'current'
    downloadType: 'specific'
    itemPattern: '/usr/envs/tmbuild/conda-bld/linux-64/*.tar.bz2'
    downloadPath: '$(System.ArtifactsDirectory)'